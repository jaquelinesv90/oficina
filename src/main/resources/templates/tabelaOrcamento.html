<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" 
	xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">

	<body>
		 <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js" type="text/javascript"></script>
	</body>
 	<div class="text-center">
 		<div class="container">
	        <table id="tabelaItens" class="table table-bordered">
		    <thead>
		        <tr>
		            <th>Produto</th>
		            <th>Descrição</th>
		            <th>Quantidade</th>
		            <th>Preço Unitário</th>
		            <th>Total</th>
		        </tr>
		    </thead>
		   <tbody>
		        <tr th:each="item, iterStat : ${itens}">
		            <td>
		                <span  th:text="*{itens[__${iterStat.index}__].item}"></span>
		            </td> 
		            <td>
		                <input type="text" class="form-control" th:field="*{itens[__${iterStat.index}__].descricao}"/>
		            </td>
		            <td>
		                <input type="number" class="form-control quantidade" th:field="*{itens[__${iterStat.index}__].quantidade}"/>
		            </td>
		            <td>
		                <input type="number" class="form-control preco" th:field="*{itens[__${iterStat.index}__].valorUnitario}"/>
		            </td>
		            <td>
		                <span class="subtotal">00.00</span>
		            </td>
		        </tr>
		    </tbody>

		</table>
		</div>	
		<div class="container">
			<div class="alinhar-a-direita">
			  <div><b>Total Geral: </b><span id="totalGeral"> 00.00</span></div>
			</div>
		</div>
   </div> 
	<script>
        function atualizarTotais() {
            const linhas = document.querySelectorAll('#tabelaItens tbody tr');
            let totalGeral = 0;

            linhas.forEach((linha) => {
                const quantidade = parseFloat(linha.querySelector('.quantidade').value) || 0;
                const preco = parseFloat(linha.querySelector('.preco').value) || 0;
                const subtotal = quantidade * preco;

                // Atualizar o span visível
                linha.querySelector('.subtotal').textContent = subtotal.toFixed(2);
                // Atualizar o input oculto para envio no formulário
                const subtotalHidden = linha.querySelector('.subtotal-hidden');
                if (subtotalHidden) {
                    subtotalHidden.value = subtotal.toFixed(2);
                }

                totalGeral += subtotal;
            });

            document.getElementById('totalGeral').textContent = totalGeral.toFixed(2);
        }

        // Adicionar eventos de mudança nos inputs
        document.querySelectorAll('.quantidade, .preco').forEach(input => {
            input.addEventListener('input', atualizarTotais);
        });

        // Calcular tudo na primeira carga
        window.addEventListener('load', atualizarTotais);
    </script>

</html>